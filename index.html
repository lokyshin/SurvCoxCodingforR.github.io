<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>R-survival Tools</title>
  <script src="handsontable.full.min.js"></script>
  <link rel="stylesheet" type="text/css" href="handsontable.full.min.css">
  <script src="R_surv_cox.js"></script>  
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #F2F2F2;
      font-size: 14px;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      margin: 0 auto;
      position: relative;
    }
    body, .container {
      background-color: transparent; /* this will make the body and container backgrounds transparent */
    } 
    h1 {
      color: #336699;
      font-size: 22px;
      margin: 0;
      margin-bottom: 20px;
      text-align: left;
    }
    h2 {
      color: #336699;
      font-size: 18px;
      margin: 0;
      margin-bottom: 10px;
      text-align: left;
    }
    h3 {
      color: #336699;
      font-size: 14px;
      margin: 0;
      margin-bottom: 10px;
      text-align: left;
    }
    .area {
      margin-bottom: 20px;
    }
    #leftSide {
      display: flex;
      flex-direction: column;
    }
    textarea {
      width: 100%;
      margin-top: 20px;
    }
    .rightSide {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
    .rightSide .area {
      width: 100%;
    }
    .footer {
      font-size: 12px;
      color: #999;
      text-align: left;
      margin-top: 40px;
    }
    #bottomRightImage {
      position: absolute;
      right: 0;
      top: 0;
      max-width: 55%;
      max-height: 55%;
      z-index: -1;
    }
    @media (max-width: 600px) {
      .container {
        width: 100%;
        max-width: none;
        padding: 0;
      }
      #leftSide, .rightSide {
        flex-direction: column;
      }
      .rightSide .area {
        margin-top: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>R-ç”Ÿå­˜åˆ†æå·¥å…·é›† v2023</h1>
    <div id="leftSide">
      <div id="databaseArea" class="area">
        <h2>æ•°æ®ç¼–è¾‘åŒº</h2>
        <div id="hot"></div>
      </div>
          <div id="functionArea" class="area">
          <h2>ç»Ÿè®¡åŠŸèƒ½åŒº</h2>    
          <h3>å¸¸ç”¨åŠŸèƒ½</h>
          <p>
          <button onClick="genRdf()">ç”Ÿæˆæ•°æ®é›†</button> or      
          <button id="genRcodes_strata_or_group" onClick="genRcodes_strata_or_group()">å…¨äººç¾¤ç”Ÿå­˜åˆ†æä¸Kaplan-Meieræ›²çº¿ï¼Œä¸æŒ‰ç»„åˆ†æï¼š</button>
          <select id="colSelect_strata_or_group" name="colSelect_strata_or_group"></select>
          <hr>
          <h3>å•å› ç´ ä¸å¤šå› ç´ Coxå›å½’åˆ†æ</h3>
          1. é€‰æ‹©ä¸€ä¸ªå˜é‡: 
          <select id="colSelect_coxuni" name="colSelect_coxuni"></select> æ”¾å…¥ 
          <button id="genRcodesCoxUni" onClick="genRcodesCoxUni()">å•å› ç´ Coxå›å½’æ¨¡å‹</button>
          <p>2. è¯·åœ¨ä¸‹æ–¹æŒ‰ä½â€˜Shiftâ€™é€‰æ‹©å¤šä¸ªå˜é‡ï¼š
          <br>
          <select id="multiSelect_coxmulti" multiple></select> æ”¾å…¥ 
          <button id="genRcodesCoxMul" onClick="genRcodesCoxMul()">å¤šå› ç´ Coxå›å½’æ¨¡å‹</button>
          <hr>
          <h3>è¿ç»­å˜é‡çš„ç»Ÿè®¡æè¿°ä¸åˆ†ç»„å¯¹æ¯”</h3>
          <h4>æ¯”è¾ƒå‡æ•°/ä¸­ä½æ•°æ˜¯å¦ç›¸åŒ</h4>
          è¯·é€‰æ‹©ä¸€ä¸ªå¾…åˆ†æåˆ†æå˜é‡ï¼š
          <select id="colSelect_R_des_continuous" name="colSelect_R_des_continuous"></select>
           è¯·é€‰æ‹©ç»„åˆ«ï¼š
          <select id="colSelect_R_des_continuous_by" name="colSelect_R_des_continuous_by"></select> 
          <button id="genRcodesR_des_continuous_by_btn" onClick="genRcodesR_des_continuous_by()"> å¼€å§‹åˆ†æï¼</button>
          <br>
          è¯·æ³¨æ„ï¼šåˆ†æçš„å˜é‡éœ€è¦æ˜¯è¿ç»­å˜é‡ï¼›ç»„åˆ«éœ€è¦æ˜¯åˆ†ç±»å˜é‡ï¼ˆéç­‰çº§å˜é‡ï¼‰ã€‚
          <hr>
          <h3>åˆ†ç±»å˜é‡çš„ç»Ÿè®¡æè¿°ä¸åˆ†å¸ƒå¯¹æ¯”</h3>
          <h4>æ¯”è¾ƒå„ç»„æ•´ä½“åˆ†å¸ƒæ˜¯å¦ç›¸åŒ</h4>
          è¯·é€‰æ‹©ä¸€ä¸ªå¾…åˆ†æçš„è¿ç»­å˜é‡ï¼š  
          <select id="colSelect_R_des_count_R" name="colSelect_R_des_count_R"></select>
           è¯·é€‰æ‹©ç»„åˆ«ï¼š
          <select id="colSelect_R_des_count_C" name="colSelect_R_des_count_C"></select> 
          <button id="genRcodesR_des_count" onClick="genRcodesR_des_count()"> å¼€å§‹åˆ†æï¼</button>
          <br>
          è¯·æ³¨æ„åˆ†æå˜é‡å’Œç»„åˆ«éƒ½éœ€è¦æ˜¯åˆ†ç±»å˜é‡ï¼ˆéç­‰çº§å˜é‡ï¼‰ã€‚
          <hr>
          <h3>ç­‰çº§å˜é‡çš„ç»Ÿè®¡åˆ†æ(ç»„åˆ« > 1)</h3>
          <h4>æ¯”è¾ƒå„ç»„æ•´ä½“ä¸­ä½æ•°æ˜¯å¦ç›¸åŒ</h4>
          è¯·é€‰æ‹©ä¸€ä¸ªå¾…åˆ†æçš„ç­‰çº§å˜é‡ï¼ˆç±»åˆ«>2ï¼‰
          <select id="colSelect_R_des_ranked_R" name="colSelect_R_des_ranked_R"></select>
           è¯·é€‰æ‹©ç»„åˆ«ï¼š
          <select id="colSelect_R_des_ranked_C" name="colSelect_R_des_ranked_C"></select> 
          <button id="genRcodesR_des_ranked" onClick="genRcodesR_des_ranked()"> å¼€å§‹åˆ†æï¼</button>
          <br>
          è¯·ç•™æ„åˆ†æçš„å˜é‡éœ€è¦æ˜¯ç­‰çº§å˜é‡ï¼ˆéåˆ†ç±»å˜é‡ï¼‰ã€‚
          <hr>
        </div>
    </div>
    <div id="rightSide">
      <div id="rcodesArea" class="area">
        <h2>ç”Ÿæˆçš„Rä»£ç åŒº</h2>
        <textarea id="Rcodes_textarea" rows="10" cols="50"></textarea>
      </div>
    </div>
    <p class="footer">
      Created by Lokyshin Zhao
      <br>
      <br>
      ä½¿ç”¨è¯´æ˜ 
      <br>
      1. åœ¨"æ•°æ®ç¼–è¾‘åŒº"ä¸­è¾“å…¥æ•°æ®ã€‚å˜é‡åç§°â€œPatient_id"ã€â€œStrata"ã€â€œTime_to_event" å’Œ â€œEvent" ä½œä¸ºç³»ç»Ÿä¿ç•™å˜é‡ã€‚æ•°æ®è¾“å…¥æ”¯æŒä»ç”µå­è¡¨æ ¼å¤åˆ¶å’Œç²˜è´´ï¼Œå¯ç‚¹å‡»åˆ—åæ›´æ”¹å˜é‡åç§°ï¼Œå¯åœ¨è¡¨æ ¼åŒºåŸŸå³é”®æ·»åŠ æˆ–åˆ é™¤è¡Œå’Œåˆ—ã€‚
      <br>
      2. ä½ å¯ä»¥ç‚¹å‡»â€œç”Ÿæˆæ•°æ®æ¡†æ¶â€ä»¥ç”ŸæˆRä½¿ç”¨çš„æ•°æ®é›†ï¼Œæˆ–ç‚¹å‡»å…¶ä»–æŒ‰é’®ä»¥ç”Ÿæˆå®Œæ•´çš„ç”¨äºç”Ÿå­˜åˆ†æçš„ R ä»£ç ã€‚åŒ…æ‹¬ç”Ÿå­˜åˆ†æã€KM æ›²çº¿ç»˜åˆ¶å’Œ Cox å•å› ç´ åˆ†æã€è¿ç»­å˜é‡ã€åˆ†ç±»å˜é‡ã€ç­‰çº§å˜é‡åˆ†ç»„æ¯”è¾ƒç­‰åŠŸèƒ½ã€‚ä»£ç åŠ å…¥äº†ç»Ÿè®¡åˆ†æï¼Œå¯æ ¹æ®ç»Ÿè®¡ç»“æœè‡ªåŠ¨ç»™å‡ºåˆ†ææŠ¥å‘Šå’Œç»“è®ºï¼Œä½†ä»…ä¾›å‚è€ƒã€‚
      <br>
      3. ç²˜è´´æ•°æ®ã€é€‰æ‹©å˜é‡ã€ç‚¹å‡»æŒ‰é’®å³å¯è‡ªåŠ¨ç”ŸæˆRä»£ç å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œåœ¨æ‰“å¼€çš„åœ¨çº¿Rè½¯ä»¶ä¸­ç²˜è´´åˆ°ä»£ç åŒºåŸŸç‚¹å‡»è¿è¡Œå³å¯è½»æ¾å–å¾—ç»“æœã€‚
      <br>
      4. <u>æ•°æ®åœ¨æµè§ˆå™¨å’Œæˆ‘çš„æœåŠ¡å™¨å‡æ— ä¿ç•™ï¼Œä½†è¯·ç•™æ„æœ¬ä»£ç è°ƒç”¨çš„åœ¨çº¿æœåŠ¡å¯èƒ½å­˜ç•™ï¼Œå¦‚githubã€rrdr.ioã€‚è¯·è°¨æ…ä½¿ç”¨ï¼Œä¸è¦å½•å…¥æ•æ„Ÿä¿¡æ¯ã€‚</u>
      <br>
      <br>
      æˆ‘æä¾›çš„å…¶ä»–å·¥å…·ï¼š
      <br>
      <a href="index_en.html" target="_blank">English version of R-survival Tools</a>
      <br>
      <a href = https://bing.lokyshin.net target="_blank">New bing on lokyshin.net</a>
      <br> 
      <a href = https://chat.lokyshin.net target="_blank">ChatGPT on lokyshin.net</a>      
      <br>
      <br>
      Copyright(r) <a href = https://lokyshin.net target="_blank">lokyshin.net</a>   
    </p>
     <img src="img.png" id="bottomRightImage" />
  </div>
    <script>

    var data = [
      ["1", "2.6", "1", "1", "0"],
      ["2", "9.3", "1", "1", "1"],
      ["3", "8.2", "0", "0", "1"],
      ["4", "12.8", "0", "1", "0"],
      ["5", "7.2", "1", "0", "1"],
      ["6", "17.4", "0", "0", "0"],
      ["7", "11.6", "1", "1", "1"],
      ["8", "17.9", "0", "0", "0"],
      ["9", "9.2", "1", "1", "1"],
      ["10", "10.4", "0", "0", "0"],
      ["11", "2.8", "1", "1", "1"],
      ["12", "4.8", "0", "0", "0"],
      ["13", "16.1", "1", "1", "1"],
      ["14", "12.3", "0", "0", "0"],
      ["15", "11.7", "1", "0", "1"],
      ["16", "9.8", "0", "0", "1"]
    ];

    var container = document.getElementById('hot');
    var hot = new Handsontable(container, {
      data: data,
      colHeaders: ["Patient_id", "Time_to_event", "Event", "Groups", "Factor"],
      contextMenu: {
        items: {
          "copy": {name:'å¤åˆ¶ | Ctrl + C'},
          "cut": {name:'å‰ªåˆ‡ | Ctrl + X'},
          "paste": {
            name:'ç²˜è´´ | å› æµè§ˆå™¨é™åˆ¶è¯·ä½¿ç”¨ Ctrl + V',
            disabled: function() { 
              return true; 
            }
          },
          "undo": {name:'æ’¤é”€ | Ctrl + Z'},
          "redo": {name:'é‡åš | Ctrl + Y'},
          "hsep1": "---------", 
          "col_right": {
            name: 'å³ä¾§æ·»åŠ åˆ—',
            disabled: function() {
              return this.getSelectedLast()[1] < 3; // Disable "Insert column right" if first four columns are selected
            }
          },
          "col_left": {
            name: 'å·¦ä¾§æ·»åŠ åˆ—',
            disabled: function() {
              return this.getSelectedLast()[1] <= 3; // Disable "Insert column left" if first four columns are selected
            }
          },
          "remove_col": {
             name: 'åˆ é™¤åˆ—',
             disabled: function() {
               // this.getSelectedLast() returns an array [startRow, startCol, endRow, endCol]
               const selectedLast = this.getSelectedLast();
               if (selectedLast) {
                 const startCol = selectedLast[1];
                 const endCol = selectedLast[3];
                 // Check if any of the first four columns are selected
                 return (startCol < 4 || endCol < 4);
                } else {
                  return false;
                }
              }
            },
          "hsep2": "---------",
          "row_below": {name:'ä¸‹æ–¹æ·»åŠ è¡Œ'},
          "row_above": {name:'ä¸‹æ–¹æ·»åŠ è¡Œ'},
                    "remove_row": {
               name: 'åˆ é™¤è¡Œ',
            disabled: function() {
              let disableRemoveRow = false;
              let selected = this.getSelected();  // returns an array of arrays [startRow, startCol, endRow, endCol]
              if(selected !== undefined) {
                selected.forEach(selection => {
                  // Iterate through each selected column
                  for (let i = selection[1]; i <= selection[3]; i++) {
                    if ((selection[2] - selection[0] + 1) === hot.countRows()) {
                      disableRemoveRow = true;
                    }
                  }
                });
              }
              // Disable "Remove row" if all rows in any column are selected
              return disableRemoveRow;
            }
          },
        }
      },
      minSpareRows: 0,
      licenseKey: 'non-commercial-and-evaluation',
      afterChange: function (change, source) {
        if (source === 'loadData') {
          return; 
        }
        updateDropdown(); 
      },
      afterCreateCol: function(index, amount) {
        var colHeaders = this.getColHeader();
        for(var i=0; i<amount; i++) {
          let newColName = "New_col"+(colHeaders.length+1);
          while(colHeaders.includes(newColName)) {
            newColName = "New_col"+(colHeaders.length+i+1);
          }
          colHeaders.push(newColName);
        }
        this.updateSettings({colHeaders: colHeaders});
        updateDropdown(); 
      },
      afterRemoveCol: function(index, amount) {
        var colHeaders = this.getColHeader();
        colHeaders.splice(index, amount);
        this.updateSettings({colHeaders: colHeaders});
        updateDropdown(); 
      },
      afterOnCellMouseDown: function(event, coords) {
        if((coords.row === -1 && coords.col >= 4) || (coords.row === -1 && coords.col === 3)) {
          var newName = prompt("è¯·è¾“å…¥æ–°çš„å˜é‡åç§°ï¼š");
          if(newName !== null) {
            // Check column name for validity
            var re = /^[A-Za-z][A-Za-z0-9_]*[A-Za-z0-9]$/;
            if(re.test(newName) === false) {
              alert('åˆ—åå¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œä¸èƒ½åŒ…å«ä»»ä½•ç‰¹æ®Šå­—ç¬¦æˆ–ç©ºæ ¼ã€‚');
            } else {
              var colHeaders = this.getColHeader();
              if(colHeaders.includes(newName)) {
                alert('åˆ—åå·²å­˜åœ¨æˆ–ä¸å¯ç”¨ã€‚');
              } else {
                colHeaders[coords.col] = newName;
                this.updateSettings({colHeaders: colHeaders});
              }
            }
          }
        }
        updateDropdown(); 
      },
    });

    function genDataFrameCode() {
      if(!checkTableRows() || !checkTableCols()) {
        return null;
      }

      let colHeaders = hot.getColHeader();
      let output = 'df = data.frame(\n';
      for(let colIndex=0; colIndex<colHeaders.length; colIndex++) {
        let colData = '    '+colHeaders[colIndex]+' = c(';
        for(let rowIndex=0; rowIndex<hot.countRows(); rowIndex++) {
          let cellData = hot.getDataAtCell(rowIndex, colIndex);
          if(cellData !== null && cellData !== '') {
            colData += cellData + ',';
          }
        }
        colData = colData.slice(0, -1) + ')';
        output += colData + ',\n';
      }
      output = output.slice(0, -2) + '\n)';
      return output;
    }

function updateDropdown() {
    let dropdown_strata_or_group = document.getElementById('colSelect_strata_or_group');  
    let dropdown_coxuni = document.getElementById('colSelect_coxuni');
    let dropdown_colSelect_R_des_continuous = document.getElementById('colSelect_R_des_continuous');
    let dropdown_colSelect_R_des_continuous_by = document.getElementById('colSelect_R_des_continuous_by');
    let dropdown_colSelect_R_des_count_R = document.getElementById('colSelect_R_des_count_R');
    let dropdown_colSelect_R_des_count_C = document.getElementById('colSelect_R_des_count_C');
    let dropdown_colSelect_R_des_ranked_R = document.getElementById('colSelect_R_des_ranked_R');
    let dropdown_colSelect_R_des_ranked_C = document.getElementById('colSelect_R_des_ranked_C');
    let multiSelect_coxmulti = document.getElementById('multiSelect_coxmulti');
    let colHeaders = hot.getColHeader();
    dropdown_strata_or_group.innerHTML = '';
    dropdown_coxuni.innerHTML = '';
    dropdown_colSelect_R_des_continuous.innerHTML = '';
    dropdown_colSelect_R_des_continuous_by.innerHTML = '';
    dropdown_colSelect_R_des_count_R.innerHTML = '';
    dropdown_colSelect_R_des_count_C.innerHTML = '';
    dropdown_colSelect_R_des_ranked_R.innerHTML = '';
    dropdown_colSelect_R_des_ranked_C.innerHTML = '';
    multiSelect_coxmulti.innerHTML = '';
    for(let i = 0; i < colHeaders.length; i++) {
        let opt1 = document.createElement('option');
        let opt2 = document.createElement('option');
        let opt3 = document.createElement('option');
        let opt4 = document.createElement('option');
        let opt5 = document.createElement('option');
        let opt6 = document.createElement('option');
        let opt7 = document.createElement('option');
        let opt8 = document.createElement('option');
        let multiOpt = document.createElement('option');
        opt1.value = colHeaders[i];
        opt1.innerHTML = colHeaders[i];
        opt2.value = colHeaders[i];
        opt2.innerHTML = colHeaders[i];
        opt3.value = colHeaders[i];
        opt3.innerHTML = colHeaders[i];
        opt4.value = colHeaders[i];
        opt4.innerHTML = colHeaders[i];
        opt5.value = colHeaders[i];
        opt5.innerHTML = colHeaders[i];
        opt6.value = colHeaders[i];
        opt6.innerHTML = colHeaders[i];
        opt7.value = colHeaders[i];
        opt7.innerHTML = colHeaders[i];
        opt8.value = colHeaders[i];
        opt8.innerHTML = colHeaders[i];
        multiOpt.value = colHeaders[i];
        multiOpt.innerHTML = colHeaders[i];
        dropdown_strata_or_group.appendChild(opt1);        
        dropdown_coxuni.appendChild(opt2);
        dropdown_colSelect_R_des_continuous.appendChild(opt3);
        dropdown_colSelect_R_des_continuous_by.appendChild(opt4);
        dropdown_colSelect_R_des_count_R.appendChild(opt5);
        dropdown_colSelect_R_des_count_C.appendChild(opt6);
        dropdown_colSelect_R_des_ranked_R.appendChild(opt7);
        dropdown_colSelect_R_des_ranked_C.appendChild(opt8);
        multiSelect_coxmulti.appendChild(multiOpt);
        //è®¾å®šé»˜è®¤é€‰é¡¹ - ç”Ÿå­˜åˆ†æé»˜è®¤ Groups or Factor
        if(colHeaders[i] == "Groups") {
            opt1.selected = true;
        }
        //è®¾å®šé»˜è®¤é€‰é¡¹ - å•å› ç´ Coxå›å½’åˆ†æé»˜è®¤ Groups or Factor
        if(colHeaders[i] == "Factor") {
            opt2.selected = true;
        }
        //è®¾å®šé»˜è®¤é€‰é¡¹ - è®¡é‡èµ„æ–™åˆ†æå˜é‡é»˜è®¤ Time_to_event
        if(colHeaders[i] == "Time_to_event") {
            opt3.selected = true;
        }
        //è®¾å®šé»˜è®¤é€‰é¡¹ - è®¡é‡èµ„æ–™åˆ†ç»„é»˜è®¤ Groups
        if(colHeaders[i] == "Groups") {
            opt4.selected = true;
        }
        //è®¾å®šé»˜è®¤é€‰é¡¹ - è®¡æ•°èµ„æ–™åˆ†æå˜é‡é»˜è®¤ Event
        if(colHeaders[i] == "Event") {
            opt5.selected = true;
        }
        //è®¾å®šé»˜è®¤é€‰é¡¹ - è®¡æ•°èµ„æ–™ç»„é»˜è®¤ Groups or Factor
        if(colHeaders[i] == "Factor") {
            opt6.selected = true;
        }
        //è®¾å®šé»˜è®¤é€‰é¡¹ - ç­‰çº§èµ„æ–™åˆ†æå˜é‡é»˜è®¤ Event
        if(colHeaders[i] == "Event") {
            opt7.selected = true;
        }
        //è®¾å®šé»˜è®¤é€‰é¡¹ - ç­‰çº§èµ„æ–™ç»„é»˜è®¤ Groups or Factor
        if(colHeaders[i] == "Groups") {
            opt8.selected = true;
        }
    }
}


    function copyToClipboard() {
      var copyText = document.getElementById("Rcodes_textarea");
      copyText.select();
      copyText.setSelectionRange(0, 99999);
      document.execCommand("copy");
    }

    function checkTableCols() {
      let colHeaders = hot.getColHeader();
      for(let colIndex=0; colIndex<colHeaders.length; colIndex++) {
        let colEmpty = true;
        let skipEmptyCell = true;
        for(let rowIndex=0; rowIndex<hot.countRows(); rowIndex++) {
          let cellData = hot.getDataAtCell(rowIndex, colIndex);
          if(cellData !== null && cellData !== '') {
            if(cellData.trim() === '') {
              if(!skipEmptyCell) {
                alert('è¯·ç”¨æ•°å­—å¡«å†™ç¬¬' + (colIndex + 1) + ' åˆ—çš„ç©ºç™½å•å…ƒæ ¼ã€‚');
                return false;
              }
            } else {
              colEmpty = false;
              skipEmptyCell = false;
            }
          }
        }
        if(colEmpty) {
          alert('ç¬¬ ' + (colIndex + 1) + ' åˆ—ä¸ºç©ºæˆ–å¡«å†™äº†å…¶ä»–å­—ç¬¦ï¼Œè¯·å¡«å†™æ•°æ®æˆ–åˆ é™¤è¯¥åˆ—ã€‚');
          return false;
        }
      }
      return true;
    }
    /* End of helper functions */

    /* Helper functions to check table content */
    function checkTableRows() {
      if(hot.countRows() === 1) {
        alert('æ‚Ÿç©ºè¯·ä¸è¦è°ƒçš®ã€‚');
        return false;
      }
      return true;
    }

    function checkTableData() {
      let rowLength = hot.countRows();
      let colLength = hot.countCols();

      for(let rowIndex=0; rowIndex<rowLength; rowIndex++) {
        for(let colIndex=0; colIndex<colLength; colIndex++) {
          let cellData = hot.getDataAtCell(rowIndex, colIndex);
          if(cellData === null || cellData === '' || isNaN(cellData)) {
            alert('è¡¨æ ¼æ•°å­—éœ€è¦å¡«å†™å®Œæ•´ã€‚è¯·æ£€æŸ¥ç¬¬ ' + (rowIndex + 1) + ' è¡Œç¬¬ ' + (colIndex + 1) + ' åˆ—çš„å•å…ƒæ ¼æ˜¯å¦ç©ºç™½æˆ–å¡«å†™äº†éæ•°å­—çš„å­—ç¬¦ã€‚');
            return false;
          }
        }
      }
      return true;
    }

    function genRdf() {
      if(!checkTableCols() || !checkTableData()) {
        return;
      }
      let dfCode = genDataFrameCode();
      if(dfCode === null) {
        return;
      }
      document.getElementById('Rcodes_textarea').value = dfCode;
      copyToClipboard();
      alert("å¾ˆæ£’ï¼\nR ä»£ç å·²ç»å¤åˆ¶åˆ°å‰ªè´´æ¿ğŸ“‹ã€‚");
    }

    function genRcodes_strata_or_group() {
        let selectedCol_strata_or_group = document.getElementById('colSelect_strata_or_group').value;
        if(!selectedCol_strata_or_group) {
            alert('è¯·é€‰æ‹©ä¸€ä¸ªå˜é‡ã€‚');
            return;
        }
        if((selectedCol_strata_or_group === "Patient_id") || (selectedCol_strata_or_group === "Time_to_event") || (selectedCol_strata_or_group === "Event") ) {
            alert('è¯·ä¸è¦é€‰æ‹© \'Patient_id\'ã€\'Time_to_event\' æˆ– \'Event\'å“¦ï¼Œè¿™äº›æ˜¯æ¨¡å‹ä¿ç•™å˜é‡ã€‚');
            return;
        }
        if(!checkTableCols() || !checkTableData()) {
            return;
        }
        let dfCode = genDataFrameCode();
        if(dfCode === null) {
            return;
        }

        var rCodes_strata_or_group = window.R_strata_or_group;
        rCodes_strata_or_group = rCodes_strata_or_group.replace(/df = .*?\)\n\)/s, dfCode);
        rCodes_strata_or_group = rCodes_strata_or_group.replace(/Strata_factor/g, selectedCol_strata_or_group); 
        document.getElementById('Rcodes_textarea').value = rCodes_strata_or_group;
        copyToClipboard();   
        alert("å¾ˆæ£’ï¼\nR ä»£ç å·²ç»å¤åˆ¶åˆ°å‰ªè´´æ¿ğŸ“‹ã€‚\nè¯·åœ¨æ–°å¼¹å‡ºçª—å£ä¸­çš„é¡¶éƒ¨æ–‡æœ¬æ¡†ä¸­ç²˜è´´ï¼Œå¹¶ç‚¹å‡»â€œè¿è¡Œâ€ä»¥æŸ¥çœ‹ç»“æœå§ã€‚");
        window.open('https://rdrr.io/snippets/embed/', '_blank')         
    }

    function genRcodesCoxUni() {
        let selectedCol_coxuni = document.getElementById('colSelect_coxuni').value;
        if(!selectedCol_coxuni) {
            alert('è¯·é€‰æ‹©ä¸€ä¸ªå˜é‡ã€‚');
            return;
        }
        if((selectedCol_coxuni === "Patient_id") || (selectedCol_coxuni === "Time_to_event") || (selectedCol_coxuni === "Event") ) {
            alert('è¯·ä¸è¦é€‰æ‹© \'Patient_id\'ã€\'Time_to_event\' æˆ– \'Event\'å“¦ï¼Œè¿™äº›æ˜¯æ¨¡å‹ä¿ç•™å˜é‡ã€‚');
            return;
        }
        if(!checkTableCols() || !checkTableData()) {
            return;
        }
        let dfCode = genDataFrameCode();
        if(dfCode === null) {
            return;
        }

        var rCodes_coxuni = window.R_cox;
        rCodes_coxuni = rCodes_coxuni.replace(/df = .*?\)\n\)/s, dfCode);
        rCodes_coxuni = rCodes_coxuni.replace(/Strata_factor/g, selectedCol_coxuni); 
        rCodes_coxuni = rCodes_coxuni.replace(/Coxå›å½’åˆ†æ/g, "å•å› ç´ Coxå›å½’åˆ†æ"); 
        document.getElementById('Rcodes_textarea').value = rCodes_coxuni;
        copyToClipboard();   
        alert("å¾ˆæ£’ï¼\nR ä»£ç å·²ç»å¤åˆ¶åˆ°å‰ªè´´æ¿ğŸ“‹ã€‚\nè¯·åœ¨æ–°å¼¹å‡ºçª—å£ä¸­çš„é¡¶éƒ¨æ–‡æœ¬æ¡†ä¸­ç²˜è´´ï¼Œå¹¶ç‚¹å‡»â€œè¿è¡Œâ€ä»¥æŸ¥çœ‹ç»“æœå§ã€‚");
        window.open('https://rdrr.io/snippets/embed/', '_blank')         
    }

    function genRcodesCoxMul() {
        let selectElement = document.getElementById('multiSelect_coxmulti');
        let selectedOptions = Array.from(selectElement.options)
                                    .filter(option => option.selected)
                                    .map(option => option.value);
        let selected_multi = selectedOptions.join(' + ');

        if (selected_multi === '' || 
            selected_multi.includes('Patient_id') || 
            selected_multi.includes('Time_to_event') || 
            selected_multi.includes('Event')) {
            alert('è¯·åœ¨å¤šå› ç´ å›å½’æ¨¡å‹å·¦ä¾§çš„å˜é‡åˆ—è¡¨ä¸­ï¼ŒæŒ‰ä½â€˜Shiftâ€™é€‰æ‹©å¤šä¸ªå˜é‡ã€‚è¯·ä¸è¦é€‰æ‹© \'Patient_id\'ã€\'Time_to_event\' æˆ– \'Event\'å“¦ï¼Œè¿™äº›æ˜¯æ¨¡å‹ä¿ç•™å˜é‡ã€‚\n\nè¯·æ³¨æ„ï¼Œé€šå¸¸åœ¨è¿›è¡Œå•å› ç´ åˆ†æåä¼šè¿›è¡Œå¤šå› ç´ åˆ†æï¼Œå¹¶é€‰æ‹© Harzad ratio å¯¹åº” P å€¼ < 0.05 çš„å˜é‡ã€‚');
            return;
        } 

        if(!checkTableCols() || !checkTableData()) {
            return;
        }
        let dfCode = genDataFrameCode();
        if(dfCode === null) {
            return;
        }

        var rCodes_coxmulti = window.R_cox;
        rCodes_coxmulti = rCodes_coxmulti.replace(/df = .*?\)\n\)/s, dfCode);
        rCodes_coxmulti = rCodes_coxmulti.replace(/Strata_factor/g, selected_multi); 
        rCodes_coxmulti = rCodes_coxmulti.replace(/Coxå›å½’åˆ†æ/g, "å¤šå› ç´ Coxå›å½’åˆ†æ"); 
        document.getElementById('Rcodes_textarea').value = rCodes_coxmulti;
        copyToClipboard();   
        alert("å¾ˆæ£’ï¼\nR ä»£ç å·²ç»å¤åˆ¶åˆ°å‰ªè´´æ¿ğŸ“‹ã€‚\nè¯·åœ¨æ–°å¼¹å‡ºçª—å£ä¸­çš„é¡¶éƒ¨æ–‡æœ¬æ¡†ä¸­ç²˜è´´ï¼Œå¹¶ç‚¹å‡»â€œè¿è¡Œâ€ä»¥æŸ¥çœ‹ç»“æœå§ã€‚");
        window.open('https://rdrr.io/snippets/embed/', '_blank')         
    }

    function genRcodesR_des_continuous_by() {
        let selectedCol_R_des_continuous = document.getElementById('colSelect_R_des_continuous').value;
        if(!selectedCol_R_des_continuous) {
            alert('è¯·é€‰æ‹©ä¸€ä¸ªå¾…åˆ†æçš„è¿ç»­å˜é‡ã€‚');
            return;
        }
        let selectedCol_R_des_continuous_by = document.getElementById('colSelect_R_des_continuous_by').value;
        if(!selectedCol_R_des_continuous_by) {
            alert('è¯·é€‰æ‹©ç”¨äºåˆ†ç»„çš„åˆ†ç±»å˜é‡æˆ–ç­‰çº§å˜é‡ã€‚');
            return;
        }
        if(!checkTableCols() || !checkTableData()) {
            return;
        }
        let dfCode = genDataFrameCode();
        if(dfCode === null) {
            return;
        }

        var rCodes_coxuni = window.R_des_continuous;
        rCodes_coxuni = rCodes_coxuni.replace(/df = .*?\)\n\)/s, dfCode);
        rCodes_coxuni = rCodes_coxuni.replace(/RDCvariate/g, selectedCol_R_des_continuous); 
        rCodes_coxuni = rCodes_coxuni.replace(/RDCgroup/g, selectedCol_R_des_continuous_by); 
        document.getElementById('Rcodes_textarea').value = rCodes_coxuni;
        copyToClipboard();   
        alert("å¾ˆæ£’ï¼\nR ä»£ç å·²ç»å¤åˆ¶åˆ°å‰ªè´´æ¿ğŸ“‹ã€‚\nè¯·åœ¨æ–°å¼¹å‡ºçª—å£ä¸­çš„é¡¶éƒ¨æ–‡æœ¬æ¡†ä¸­ç²˜è´´ï¼Œå¹¶ç‚¹å‡»â€œè¿è¡Œâ€ä»¥æŸ¥çœ‹ç»“æœå§ã€‚");
        window.open('https://rdrr.io/snippets/embed/', '_blank')         
    }

    function genRcodesR_des_count() {
        let selectedCol_R_des_count_R = document.getElementById('colSelect_R_des_count_R').value;
        if(!selectedCol_R_des_count_R) {
            alert('è¯·é€‰æ‹©ä¸€ä¸ªå¾…åˆ†æçš„åˆ†ç±»å˜é‡ã€‚');
            return;
        }
        let selectedCol_R_des_count_C = document.getElementById('colSelect_R_des_count_C').value;
        if(!selectedCol_R_des_count_C) {
            alert('è¯·é€‰æ‹©ç”¨äºåˆ†ç»„çš„åˆ†ç±»å˜é‡ã€‚');
            return;
        }
        if(!checkTableCols() || !checkTableData()) {
            return;
        }
        let dfCode = genDataFrameCode();
        if(dfCode === null) {
            return;
        }

        var rCodes_coxuni = window.R_des_count;
        rCodes_coxuni = rCodes_coxuni.replace(/df = .*?\)\n\)/s, dfCode);
        rCodes_coxuni = rCodes_coxuni.replace(/RD_characteristic/g, selectedCol_R_des_count_R); 
        rCodes_coxuni = rCodes_coxuni.replace(/RD_classfication/g, selectedCol_R_des_count_C); 
        document.getElementById('Rcodes_textarea').value = rCodes_coxuni;
        copyToClipboard();   
        alert("å¾ˆæ£’ï¼\nR ä»£ç å·²ç»å¤åˆ¶åˆ°å‰ªè´´æ¿ğŸ“‹ã€‚\nè¯·åœ¨æ–°å¼¹å‡ºçª—å£ä¸­çš„é¡¶éƒ¨æ–‡æœ¬æ¡†ä¸­ç²˜è´´ï¼Œå¹¶ç‚¹å‡»â€œè¿è¡Œâ€ä»¥æŸ¥çœ‹ç»“æœå§ã€‚");
        window.open('https://rdrr.io/snippets/embed/', '_blank')         
    }

    function genRcodesR_des_ranked() {
        let selectedCol_R_des_ranked_R = document.getElementById('colSelect_R_des_ranked_R').value;
        if(!selectedCol_R_des_ranked_R) {
            alert('è¯·é€‰æ‹©ä¸€ä¸ªå¾…åˆ†æçš„ç­‰çº§å˜é‡ã€‚');
            return;
        }
        let selectedCol_R_des_ranked_C = document.getElementById('colSelect_R_des_ranked_C').value;
        if(!selectedCol_R_des_ranked_C) {
            alert('è¯·é€‰æ‹©ç”¨äºåˆ†ç»„çš„åˆ†ç±»å˜é‡');
            return;
        }
        if(!checkTableCols() || !checkTableData()) {
            return;
        }
        let dfCode = genDataFrameCode();
        if(dfCode === null) {
            return;
        }

        var rCodes_coxuni = window.R_des_ranked;
        rCodes_coxuni = rCodes_coxuni.replace(/df = .*?\)\n\)/s, dfCode);
        rCodes_coxuni = rCodes_coxuni.replace(/RD_grade_value/g, selectedCol_R_des_ranked_R); 
        rCodes_coxuni = rCodes_coxuni.replace(/RD_grade_group/g, selectedCol_R_des_ranked_C); 
        document.getElementById('Rcodes_textarea').value = rCodes_coxuni;
        copyToClipboard();   
        alert("å¾ˆæ£’ï¼\nR ä»£ç å·²ç»å¤åˆ¶åˆ°å‰ªè´´æ¿ğŸ“‹ã€‚\nè¯·åœ¨æ–°å¼¹å‡ºçª—å£ä¸­çš„é¡¶éƒ¨æ–‡æœ¬æ¡†ä¸­ç²˜è´´ï¼Œå¹¶ç‚¹å‡»â€œè¿è¡Œâ€ä»¥æŸ¥çœ‹ç»“æœå§ã€‚");
        window.open('https://rdrr.io/snippets/embed/', '_blank')         
    }

    updateDropdown(); 
  </script>
</body>
</html>
